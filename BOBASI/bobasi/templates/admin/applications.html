{% extends 'admin/base.html' %}
{% block title %}Applications ‚Äî Bobasi BBS{% endblock %}
{% block page_title %}Applications{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header">
    <h3>All Applications {% if status %}<span class="badge badge-{{ status }}">{{ status.replace('_',' ').title() }}</span>{% endif %}</h3>
    <div style="display:flex;gap:8px;align-items:center;">
      <form method="GET" style="display:flex;gap:8px;">
        {% if status %}<input type="hidden" name="status" value="{{ status }}">{% endif %}
        <input type="text" name="search" value="{{ search }}" placeholder="Search name, ref, institution..." class="search-input">
        <button type="submit" class="btn btn-primary btn-sm">Search</button>
        {% if search %}<a href="{{ url_for('admin.applications') }}{% if status %}?status={{ status }}{% endif %}" class="btn btn-sm btn-outline">Clear</a>{% endif %}
      </form>
    </div>
  </div>
  <div class="filter-tabs">
    <a href="{{ url_for('admin.applications') }}" class="filter-tab {% if not status %}active{% endif %}">All</a>
    <a href="{{ url_for('admin.applications') }}?status=pending" class="filter-tab {% if status == 'pending' %}active{% endif %}">‚è≥ Pending</a>
    <a href="{{ url_for('admin.applications') }}?status=under_review" class="filter-tab {% if status == 'under_review' %}active{% endif %}">üîç Under Review</a>
    <a href="{{ url_for('admin.applications') }}?status=approved" class="filter-tab {% if status == 'approved' %}active{% endif %}">‚úÖ Approved</a>
    <a href="{{ url_for('admin.applications') }}?status=rejected" class="filter-tab {% if status == 'rejected' %}active{% endif %}">‚ùå Rejected</a>
    <a href="{{ url_for('admin.applications') }}?status=disbursed" class="filter-tab {% if status == 'disbursed' %}active{% endif %}">üí∞ Disbursed</a>
  </div>
  <div class="table-wrap">
    <table class="admin-table">
      <thead>
        <tr><th>#</th><th>Reference</th><th>Student</th><th>Institution</th><th>Course</th><th>Requested</th><th>Approved</th><th>Status</th><th>Submitted</th><th></th></tr>
      </thead>
      <tbody>
        {% for a in applications %}
        <tr>
          <td>{{ loop.index }}</td>
          <td><span class="sn-tag">{{ a.application_number }}</span></td>
          <td><strong>{{ a.student.full_name }}</strong></td>
          <td>{{ (a.institution or '')[:25] }}{% if (a.institution or '')|length > 25 %}...{% endif %}</td>
          <td>{{ (a.course or '')[:20] }}{% if (a.course or '')|length > 20 %}...{% endif %}</td>
          <td>KShs. {{ "{:,.0f}".format(a.requested_amount) }}</td>
          <td>{% if a.approved_amount %}KShs. {{ "{:,.0f}".format(a.approved_amount) }}{% else %}‚Äî{% endif %}</td>
          <td><span class="badge badge-{{ a.status }}">{{ a.status.replace('_',' ').title() }}</span></td>
          <td>{{ a.submitted_at.strftime('%d/%m/%Y') }}</td>
          <td><a href="{{ url_for('admin.view_application', app_id=a.id) }}" class="btn-xs">View</a></td>
        </tr>
        {% else %}
        <tr><td colspan="10" class="no-data">No applications found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="table-footer">Total: <strong>{{ applications|length }}</strong> applications</div>
</div>
{% endblock %}
